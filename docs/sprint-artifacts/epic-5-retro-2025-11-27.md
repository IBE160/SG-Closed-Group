# Epic 5 Retrospective: Bålmelding (Bonfire) Registration System

**Date:** 2025-11-27
**Epic:** Epic 5 - Bålmelding Registration System
**Team Members:** BIP + medstudent

---

## Epic Summary

Epic 5 implementerte et komplett bålmeldingssystem med:
- Google Maps-integrasjon for visning av bålmeldinger
- Manuell bålregistrering via skjema
- Azure OpenAI-drevet AI-chat for parsing av bålmeldinger
- Kommunefiltrering (29 hardkodede kommuner)
- Automatisk utløp av bålmeldinger (kl 04:00 dagen etter)
- Admin-godkjenningskø for flaggede registreringer

### Stories Completed
| Story | Status |
|-------|--------|
| 5-1 Google Maps Integration | Done |
| 5-2 Manual Bonfire Registration | Done |
| 5-3 Azure OpenAI Email Parsing | Done |
| 5-4 Power Automate Integration | Skipped |
| 5-5 Municipality Filtering | Done |
| 5-6 Automatic Bonfire Expiration | Done |
| 5-7 Manual Review Queue | Done |

---

## What Went Well

### API-integrasjon med AI Agent og Maps
- Oppsettet med API mot AI-agenten fungerte bra
- Google Maps-integrasjonen ble vellykket implementert
- Azure Table Storage for lagring av bålmeldinger
- AI SDK v5-migrering ble fullført med `useChat` hook og `streamText`

---

## Challenges Encountered

### 1. Git Merge-konflikter
- **Problem:** Teammedlemmene jobbet i ulike retninger, noe som førte til komplikasjoner ved merge
- **Løsning:** Løste konfliktene manuelt og fikk koden til å fungere sammen

### 2. Google Maps Display Issues
- **Problem:** Utfordringer med å få Google Maps-kartet til å vise korrekt
- **Løsning:** Feilsøking og konfigurasjonsendringer - "det ordnet seg til slutt"

### 3. Power Automate Beslutning
- **Opprinnelig plan:** Integrere med Power Automate for e-postovervåking
- **Beslutning:** Droppet Power Automate til fordel for et egenutviklet bålmeldingsskjema
- **Resultat:** Enklere arkitektur med direkte kobling til kart og storage

---

## Lessons Learned

### Hyppigere Git-oppdateringer
> "Huske å oppdatere oftere på git, slik at vi ikke har for ulike koder når vi skal merge."

**Anbefaling for fremtidige epics:**
- Push/pull oftere for å holde kodebasen synkronisert
- Koordiner bedre når flere jobber på samme område
- Bruk feature branches med hyppige merges til main

---

## Key Decisions Made

| Beslutning | Begrunnelse |
|------------|-------------|
| Droppet Power Automate (5-4) | Valgte egenutviklet skjema som ga bedre kontroll og enklere arkitektur |
| Utløpstid kl 04:00 | Bålmeldinger utløper kl 04:00 dagen etter 'til'-dato |
| Azure Table Storage | Separat fra Prisma/PostgreSQL per ADR-006 |
| AI SDK v5 | Migrerte fra gammel OpenAI SDK til moderne AI SDK med streaming |

---

## Technical Artifacts

### New/Modified Files
- `app/api/chat/bonfire/route.ts` - AI SDK v5 chat API
- `components/bonfire/AIChat.tsx` - useChat hook implementasjon
- `lib/azure-table.ts` - Expiration logic (04:00)
- `app/api/bonfires/route.ts` - NextAuth-beskyttet GET, offentlig POST

### Integration Tasks Completed
- NextAuth-beskyttelse på bonfire routes
- AI SDK v5-migrering fullført

---

## Overall Assessment

> "Alt i alt syntes jeg vi løste utfordringene bra når de dukket opp."

Epic 5 ble vellykket fullført til tross for integrasjonsutfordringer. Teamet viste god evne til å tilpasse seg (droppe Power Automate) og løse tekniske problemer (Git-konflikter, Maps-visning).

---

**Status:** Complete
**Next Epic:** Epic 3 - Event Control Dashboard
